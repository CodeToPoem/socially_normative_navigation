<launch>
  <!-- VISUALIZATION -->
  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find pedsim_2dnav)/rviz/scene_one.rviz"/>

  <!-- PARAMETERS -->
  <!-- simulator parameters -->
  <param name="/pedsim/scene_file" value="$(find pedsim_simulator)scenarios/rss_scenario_one.xml" type="string"/>
  <param name="/pedsim_simulator/max_robot_speed" value="2.0" type="double"/>
  <param name="/pedsim_simulator/robot_wait_time" value="30000" type="double"/>
  <param name="/pedsim_simulator/agents_alpha" value="0.5" type="double"/>
  <param name="/pedsim_simulator/show_robot" value="true"/>
  <param name="/pedsim_simulator/teleop_flag" value="0" type="double"/>
  <param name="/pedsim_simulator/teleop_flag" value="1" type="double" if="$(arg teleop)"/>
  <param name="/use_sim_time" value="false"/>

  <!-- Behavior parameters -->
  <rosparam command="load" file="$(find social_compliance_layer)/cfg/behavior_parameters.yaml" />

  <!-- NODES -->

  <!-- Robot control in the simulator -->
  <group ns="/pedbot/control">
    <node name="driving_controller" type="simulate_diff_drive_robot" pkg="pedsim_simulator" output="screen">
        <param name="pose_initial_x" value="4.0"/>
        <param name="pose_initial_y" value="4.0"/>
        <param name="pose_initial_theta" value="0.70"/>
    </node>

    <!-- RQT robot steering -->
    <node pkg="rqt_robot_steering" name="rqt_robot_steering" type="rqt_robot_steering" if="$(arg teleop)">
        <remap from="/cmd_vel" to="/pedbot/control/cmd_vel"/>
    </node>
  </group>

  <!-- simulator node -->
  <node name="pedsim_simulator" pkg="pedsim_simulator" type="simulator" output="screen"/>

  <!-- Publishing Agents Tracks with mock component-->
  <node name="mocktracks_rss_scenario_one" pkg="pedsim_simulator" type="mocktracks_rss_scenario_one_static.py" respawn="false" output="screen" cwd="node"/>
  <!-- Publishing Groups Tracks with mock component -->
  <node name="mockgroups_rss_scenario_one" pkg="pedsim_simulator" type="mockgroups_rss_scenario_one.py" respawn="false" output="screen" cwd="node"/>



  <!-- run move base -->
  <node pkg="move_base" type="move_base" name="move_base_node" output="screen">
    <remap from="/cmd_vel" to="/spencer/control/desired_velocity"/>
    <rosparam file="$(find pedsim_2dnav)/config/move_base.yaml" command="load" />
    <rosparam file="$(find pedsim_2dnav)/config/common_params.yaml" command="load" ns="global_costmap" />
    <rosparam file="$(find pedsim_2dnav)/config/common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find pedsim_2dnav)/config/global_costmap_params.yaml" command="load" ns="global_costmap" />
    <rosparam file="$(find pedsim_2dnav)/config/local_costmap_params.yaml" command="load" ns="local_costmap" />

    <rosparam file="$(find pedsim_2dnav)/config/planner.yaml" command="load"/>
    <param name="base_global_planner" value="navfn/NavfnROS"/>
    <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS"/>
    <!-- <param name="base_local_planner" value="eband_local_planner/EBandPlannerROS"/> -->
  </node>

  <!-- Pedsim point clouds publisher -->
  <node name="pedsim_point_clouds" pkg="pedsim_point_clouds" type="pedsim_point_clouds" output="screen"/>

</launch>
