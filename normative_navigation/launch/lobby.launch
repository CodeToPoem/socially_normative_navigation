<launch>
  <!-- VISUALIZATION -->
  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find normative_navigation)/config/rviz/lobby.rviz"/>

  <!-- PARAMETERS -->
  <!-- simulator parameters -->
  <param name="/pedsim/scene_file" value="$(find normative_navigation)scenes/lobby.xml" type="string"/>
  <param name="/pedsim_simulator/max_robot_speed" value="2.0" type="double"/>
  <param name="/pedsim_simulator/robot_wait_time" value="30000" type="double"/>
  <param name="/pedsim_simulator/agents_alpha" value="0.5" type="double"/>
  <param name="/pedsim_simulator/show_robot" value="true"/>
  <param name="/pedsim_simulator/teleop_flag" value="0" type="double"/>
  <param name="/use_sim_time" value="false"/>

  <!-- Behavior parameters -->
  <rosparam command="load" file="$(find social_compliance_layer)/cfg/behavior_parameters.yaml" />

  <!-- NODES -->

  <!-- Robot control in the simulator -->
  <group ns="/pedbot/control">
    <node name="driving_controller" type="simulate_diff_drive_robot" pkg="pedsim_simulator" output="screen">
        <param name="pose_initial_x" value="4.0"/>
        <param name="pose_initial_y" value="4.0"/>
        <param name="pose_initial_theta" value="0.70"/>
    </node>
  </group>

  <!-- simulator node -->
  <node name="pedsim_simulator" pkg="pedsim_simulator" type="simulator" output="screen"/>

  <!-- Publishing Agents Tracks and Groups -->
  <node name="mock_tracks_lobby" pkg="normative_navigation" type="mock_tracks_static_lobby.py" respawn="false" output="screen" cwd="node"/>
  <node name="mock_groups_lobby" pkg="normative_navigation" type="mock_groups_lobby.py" respawn="false" output="screen" cwd="node"/>



  <!-- run move base -->
  <node pkg="move_base" type="move_base" name="move_base_node" output="screen">
    <remap from="/cmd_vel" to="/pedbot/control/cmd_vel"/>
    <rosparam file="$(find normative_navigation)/config/move_base_parameters/planner.yaml" command="load" />
    <rosparam file="$(find normative_navigation)/config/move_base_parameters/common.yaml" command="load" ns="global_costmap" />
    <rosparam file="$(find normative_navigation)/config/move_base_parameters/common.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find normative_navigation)/config/move_base_parameters/global_lobby.yaml" command="load" ns="global_costmap" />
    <rosparam file="$(find normative_navigation)/config/move_base_parameters/local_lobby.yaml" command="load" ns="local_costmap" />

    <param name="base_global_planner" value="navfn/NavfnROS"/>
    <param name="base_local_planner" value="dwa_local_planner/DWAPlannerROS"/>
    <!-- <param name="base_local_planner" value="eband_local_planner/EBandPlannerROS"/> -->
  </node>


  <!-- Pedsim point clouds publisher -->
  <node name="pedsim_point_clouds" pkg="pedsim_point_clouds" type="pedsim_point_clouds" output="screen"/>

  <node pkg="tf" type="static_transform_publisher" name="odom2base_footprint" args="0 0 0 0 0 0 base_footprint odom 10" output="log"/>

</launch>
